%! Author = aybehrouz

\section{Applications}\label{sec:applications}

An Argennon application or a smart contract is a collection of method bytecodes and heap chunks that are stored in
the AVM storage, identified by a unique application identifier. An application identifier, \texttt{applicationID}, is
a unique prefix code generated by the \emph{applications} prefix tree. (See Section~\ref{sec:identifiers}.)

An application identifier can
be considered as the address of an application and has the following standard symbolic representation:
\begin{verbatim}
<application-id> ::= "["<hex-prefix-code>"]"
<hex-prefix-code> ::= "0x"<hex-num>"."<hex-prefix-code> | "0x"<hex-num>
\end{verbatim}
where \texttt{<hex-num>} is a hexadecimal number between $0$ and $255$, using lower case
letters \texttt{[a-f]} for showing digits greater than $9$.

For example \texttt{[0x24.0xff.0xda]}, \texttt{[0x0]} and \texttt{[0x3.0xa0.0x0.0x0]}, are valid application addresses.

Argennon has two special smart contracts: the \emph{root} smart contract\footnote{also called the root app} and
the \emph{ARG} smart contract\footnote{also called the Argennon smart contract or the Argennon app.}.
The root smart contract, with \texttt{applicationID=[0x0]}, is a privileged smart contract responsible for
method invocation and installation/uninstallation of other smart contracts.
On the other hand, the ARG smart contract, with \texttt{applicationID=[0x1]}, controls the ARG token, the main
currency of the Argennon blockchain, and also manages a database of public keys and handles signature verification.

Both of these smart contracts are mutable smart contracts and can be updated by the Argennon governance protocol.


\section{Accounts}\label{sec:accounts}

Argennon accounts are entities defined inside the ARG smart contract.
Every Argennon account is uniquely identified by a prefix code generated using \emph{accounts} prefix
tree. (See Section~\ref{sec:identifiers}) An account
identifier can be considered as the address of an account and has the following standard symbolic representation:
\begin{verbatim}
<account-id> ::= "["<decimal-prefix-code>"]"
<decimal-prefix-code> ::= <dec-num>"."<decimal-prefix-code> | <dec-num>
\end{verbatim}
where \texttt{<dec-num>} is a normal decimal number between $0$ and $255$.

For example \texttt{[21.255.37]}, \texttt{[0]} and \texttt{[1.0.0.0.0]}, are valid standard symbolic representations
of account addresses.

A new account can be created by invoking \texttt{createAccount} method from the Argennon smart contract. For creating
a new account two public keys need to be provided by the caller and registered in the Argennon smart contract.
One public key will be used for issuing digital signatures, and the other one will be used for voting. The
provided public keys need to meet certain cryptographic requirements,\footnote{Argennon uses Prove
Knowledge of the Secret Key (KOSK) scheme.} and can not be already registered in the system.

If the owner of the new account is an application, the \texttt{applicationID} of the owner will be registered in the
ARG smart contract and no public keys are needed. An application can own an arbitrary number of accounts.

\note{Explicit key registration enables Argennon to decouple cryptography from blockchain design. In this way,
    if the used cryptographic algorithms turn out to be insecure for some reason, for example because
    of the introduction of quantum computers, the cryptographic algorithms could be easily upgraded.}

\section{Transactions}\label{sec:transactions}

Every Argennon transaction is a single \texttt{invoke\_external} instruction which calls a method from the Argennon
root smart contract. This method always transfers the proposed fee of the transaction in ARGs from a
sender account to the fee sink accounts and then performs the requested operation. The Argennon root smart contract
has four public methods:

\begin{itemize}
    \item \texttt{avmCall}: invokes a method from an
    AVM smart contract. Users interact with AVM smart contracts using these transactions. Transferring all
    assets, including ARGs, is done by these transactions.
    \item \texttt{installApp}: installs an AVM smart contract and determines the update policy of the smart
    contract: if the contract is updatable or not, which accounts can update or uninstall the contract, and so
    on.
    \item \texttt{unInstallApp}: removes an AVM smart contract.
    \item \texttt{updateApp}: updates an AVM smart contract (if allowed).
\end{itemize}

\subsection{Authorization}\label{subsec:txn-auth}

Argennon transactions do not have a sender. The authorization of the requested operation is always done by checking the
digital signatures that are provided as a part of the argument list to the root smart contract method.

While every block of the Argennon blockchain stores the commitment of the transaction list, Argennon does not enforce
storage of the transaction history. To be able to detect replay attacks, we require
every signature that a user creates to have a nonce. This nonce consists of the issuance round of the signature
and a sequence number: \texttt{(issuance,\ sequence)}. When a user creates more than one signature in a round, he
must sequence his signatures starting from 0 (i.e.~the sequence number restarts from 0 in every round). We define
a maximum lifetime for signatures, so a signature is invalid if \texttt{currentRound - issuance > maxLifeTime} or
if a signature of the same user with a bigger or equal nonce is already used
(i.e.~is recorded in the blockchain). A nonce is bigger than another nonce if it has an older issuance. If two
nonces have an equal issuance, the nonce with the bigger sequence number will be considered bigger.

To be able to detect invalid signatures, we keep the maximum nonce of used digital signatures per user. This information
is stored in the ARG smart contract and when the difference between \texttt{issuance} component of the nonce and
the current round becomes bigger than the maximum allowed lifetime of a signature, it can be safely
deleted.\footnote{in some conventional
blockchains, the nonce data can never be deleted, even if the account has zero balance and is no longer used.}

\subsection{Resource Declaration}\label{subsec:resource-declaration}

Every Argennon transaction is required to specify a cap for all the resources it needs. This
includes memory, network and processor related resources. The protocol defines an execution cost for
every AVM instruction, reflecting the amount of resources its emulation needs, and every transaction is required
to specify a maximum execution cost. If during emulation, a transaction reaches this maximum cost, it will be
considered failed and the network can receive the proposed fee of that transaction.

Also, Argennon transactions are required to specify what heap or code area addresses they will access. This will
enable validators to parallelize transaction validation as we will see in Section~\ref{sec:concurrency}. A transaction
that tries to access a memory location that is not in its access lists, will be rejected.
Users could use off-chain \emph{smart contract oracles} to predict the list of memory locations their transactions need.

A smart contract oracle is a full AVM emulator that keeps a full local copy of the AVM memory and can emulate AVM
execution without accessing a ZK-EDB server. Smart contract oracles can be used for reporting useful information about
Argennon transactions such as accessed AVM heap or code area locations, exact amount of execution cost,
and so on.

Every Argennon transaction is required to provide the following information as an upper bound for the
resources it needs:

\begin{itemize}
    \item Maximum execution cost
    \item A list of heap/code-area locations for reading
    \item A list of heap locations for writing
    \item A list of heap chunks it will deallocate
    \item A list of methods it will delete (if any)
    \item Number and size of heap chunks it will allocate
    \item Number and size of method bytecodes it will allocate (if any)
\end{itemize}

If a transaction tries to violate any of these predefined limitations, it will be considered failed, and the network
can receive the proposed fee of that transaction.

\subsection{Transaction Fee}\label{subsec:fee}

Every Argennon transaction is required to pay two types of fees: execution fee and storage fee. A transaction pays
its fees by providing digital signatures of one or more accounts authorizing the transfer of the amount of fee in
ARG from one or more accounts to the fee sink accounts.
\note{An Argennon transaction always pays all of its proposed fee, no matter how much of its predefined resources
were not used in the final emulation. This will incentivize users to report the resource usage of their
transactions more accurately.}

